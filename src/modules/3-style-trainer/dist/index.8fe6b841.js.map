{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/runtime-577e05ce91f7c93b.js","node_modules/cubing/src/cubing/vendor/p-lazy/p-lazy.ts","node_modules/cubing/src/cubing/twisty/model/PromiseFreshener.ts","node_modules/cubing/src/cubing/twisty/model/props/TwistyProp.ts","node_modules/cubing/src/cubing/twisty/model/props/puzzle/display/StickeringProp.ts","node_modules/cubing/src/cubing/twisty/model/props/puzzle/display/HintFaceletProp.ts","node_modules/cubing/src/cubing/twisty/views/3D/TAU.ts","node_modules/cubing/src/cubing/twisty/heavy-code-imports/3d.ts","node_modules/@parcel/runtime-js/lib/runtime-2064ee40a91036e4.js"],"sourcesContent":["require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"8hzZ2\\\":\\\"index.8fe6b841.js\\\",\\\"fUYHb\\\":\\\"3d-dynamic-DKWMBHRS.b79bc10d.js\\\",\\\"adU6T\\\":\\\"index.b9099a78.js\\\"}\"));","// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\n\n// TODO: Use private class fields when ESLint support it.\n\nexport class PLazy<T> extends Promise<T> {\n  constructor(executor) {\n    super((resolve) => {\n      resolve();\n    });\n\n    this._executor = executor;\n  }\n\n  static from(function_) {\n    return new PLazy((resolve) => {\n      resolve(function_());\n    });\n  }\n\n  static resolve(value) {\n    return new PLazy((resolve) => {\n      resolve(value);\n    });\n  }\n\n  static reject(error) {\n    return new PLazy((_resolve, reject) => {\n      reject(error);\n    });\n  }\n\n  then(onFulfilled, onRejected) {\n    this._promise = this._promise || new Promise(this._executor);\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return this._promise.then(onFulfilled, onRejected);\n  }\n\n  catch(onRejected) {\n    this._promise = this._promise || new Promise(this._executor);\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return this._promise.catch(onRejected);\n  }\n}\n\nexport function from<T>(function_): Promise<T> {\n  return new PLazy((resolve) => {\n    resolve(function_());\n  });\n}\n","// TODO: Pick a much better name.\nexport class PromiseFreshener<T> {\n  #latestAssignedIdx = 0;\n  #latestResolvedIdx = 0;\n\n  // TODO: reject instead? Drop?\n  async queue(\n    p: Promise<T>,\n  ): Promise<{ fresh: false } | { fresh: true; result: T }> {\n    const idx = ++this.#latestAssignedIdx;\n    const result = await p;\n    if (idx > this.#latestResolvedIdx) {\n      this.#latestResolvedIdx = idx;\n      return {\n        fresh: true,\n        result: result,\n      };\n    } else {\n      return { fresh: false };\n    }\n  }\n}\n\n// This will silenty drop a queued Promise (i.e. not resolve it) if a\n// newer queued one already resolved first. This is useful for classes that want\n// to know the \"latest\" state of something without jumping back to an older\n// value by accident.\n// TODO: Remove this because it's too easy to misuse?\nexport class StaleDropper<T> {\n  #latestAssignedIdx = 0;\n  #latestResolvedIdx = 0;\n\n  queue(p: Promise<T>): Promise<T> {\n    // This is a very rare case where we *do* want to drop a Promise sometimes.\n    // eslint-disable-next-line no-async-promise-executor\n    return new Promise(async (resolve, reject) => {\n      try {\n        const idx = ++this.#latestAssignedIdx;\n        const result = await p;\n        if (idx > this.#latestResolvedIdx) {\n          this.#latestResolvedIdx = idx;\n          resolve(result);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n}\n","import { from } from \"../../../vendor/p-lazy/p-lazy\";\nimport { StaleDropper } from \"../PromiseFreshener\";\nimport type { UserVisibleErrorTracker } from \"../UserVisibleErrorTracker\";\n\n/*eslint @typescript-eslint/ban-types:off */\ntype InputRecord = {};\n\nexport type InputProps<T extends InputRecord> = {\n  [s in keyof T]: TwistyPropParent<T[s]>;\n};\n\ntype InputPromises<T extends InputRecord> = {\n  [s in keyof T]: Promise<T[s]>;\n};\n\ninterface SourceEventDetail<OutputType> {\n  sourceProp: TwistyPropSource<OutputType, any>;\n  value: Promise<OutputType>; // TODO: remove?\n  generation: number;\n}\n\ntype SourceEvent<T> = CustomEvent<SourceEventDetail<T>>;\n\ntype PromiseOrValue<T> = T | Promise<T>;\n\n// Values of T must be immutable.\nlet globalSourceGeneration = 0; // This is incremented before being used, so 1 will be the first active value.\nexport abstract class TwistyPropParent<T> {\n  public abstract get(): Promise<T>;\n\n  // Don't overwrite this. Overwrite `canReuseValue` instead.\n  canReuse(v1: T, v2: T): boolean {\n    return v1 === v2 || this.canReuseValue(v1, v2);\n  }\n\n  // Overwrite with a cheap semantic comparison when possible.\n  // Note that this is not called if `v1 === v2` (in which case the value is automatically reused).\n  canReuseValue(_v1: T, _v2: T): boolean {\n    return false;\n  }\n\n  debugGetChildren(): Array<TwistyPropDerived<any, any>> {\n    return Array.from(this.#children.values());\n  }\n\n  // Propagation\n\n  #children: Set<TwistyPropDerived<any, any>> = new Set();\n  protected addChild(child: TwistyPropDerived<any, any>): void {\n    this.#children.add(child);\n  }\n\n  protected removeChild(child: TwistyPropDerived<any, any>): void {\n    this.#children.delete(child);\n  }\n\n  protected lastSourceGeneration: number = 0;\n  // Synchronously marks all descendants as stale. This doesn't actually\n  // literally mark as stale, but it updates the last source generation, which\n  // is used to tell if a cahced result is stale.\n  protected markStale(sourceEvent: SourceEvent<any>): void {\n    if (sourceEvent.detail.generation !== globalSourceGeneration) {\n      // The full stale propagation is synchronous, so there should not be a new one yet.\n      throw new Error(\"A TwistyProp was marked stale too late!\");\n    }\n    if (this.lastSourceGeneration === sourceEvent.detail.generation) {\n      // Already propagated.\n      return;\n    }\n    this.lastSourceGeneration = sourceEvent.detail.generation;\n    for (const child of this.#children) {\n      child.markStale(sourceEvent);\n    }\n    // We schedule sending out events *after* the (synchronous) propagation has happened, in\n    // case one of the listeners updates a source again.\n    this.#scheduleRawDispatch();\n  }\n\n  #rawListeners: Set<() => void> = new Set();\n  /** @deprecated */\n  addRawListener(listener: () => void, options?: { initial: boolean }): void {\n    this.#rawListeners.add(listener);\n    if (options?.initial) {\n      listener(); // TODO: wrap in a try?\n    }\n  }\n\n  /** @deprecated */\n  removeRawListener(listener: () => void): void {\n    this.#rawListeners.delete(listener);\n  }\n\n  /** @deprecated */\n  #scheduleRawDispatch(): void {\n    if (!this.#rawDispatchPending) {\n      this.#rawDispatchPending = true;\n      setTimeout(() => this.#dispatchRawListeners(), 0);\n    }\n  }\n\n  #rawDispatchPending: boolean = false;\n  #dispatchRawListeners(): void {\n    if (!this.#rawDispatchPending) {\n      throw new Error(\"Invalid dispatch state!\");\n    }\n    for (const listener of this.#rawListeners) {\n      listener(); // TODO: wrap in a try?\n    }\n    this.#rawDispatchPending = false;\n  }\n\n  #freshListeners: Map<(value: T) => void, () => void> = new Map();\n  // TODO: Pick a better name.\n  addFreshListener(listener: (value: T) => void): void {\n    const staleDropper: StaleDropper<T> = new StaleDropper<T>();\n    let lastResult: T | null = null;\n    const callback = async () => {\n      const result = await staleDropper.queue(this.get());\n      if (lastResult !== null && this.canReuse(lastResult, result)) {\n        return;\n      }\n      lastResult = result;\n      listener(result);\n    };\n    this.#freshListeners.set(listener, callback);\n    this.addRawListener(callback, { initial: true });\n  }\n\n  removeFreshListener(listener: (value: T) => void): void {\n    this.removeRawListener(this.#freshListeners.get(listener)!); // TODO: throw a custom error?\n    this.#freshListeners.delete(listener);\n  }\n}\n\nexport abstract class TwistyPropSource<\n  OutputType,\n  InputType = OutputType,\n> extends TwistyPropParent<OutputType> {\n  #value: Promise<OutputType>;\n\n  public abstract getDefaultValue(): PromiseOrValue<OutputType>;\n\n  constructor(initialValue?: PromiseOrValue<InputType>) {\n    super();\n    this.#value = from(() => this.getDefaultValue());\n    if (initialValue) {\n      this.#value = this.deriveFromPromiseOrValue(initialValue, this.#value);\n    }\n  }\n\n  set(input: PromiseOrValue<InputType>): void {\n    this.#value = this.deriveFromPromiseOrValue(input, this.#value);\n\n    const sourceEventDetail: SourceEventDetail<OutputType> = {\n      sourceProp: this,\n      value: this.#value,\n      generation: ++globalSourceGeneration,\n    };\n    this.markStale(\n      new CustomEvent<SourceEventDetail<OutputType>>(\"stale\", {\n        detail: sourceEventDetail,\n      }),\n    );\n  }\n\n  async get(): Promise<OutputType> {\n    return this.#value;\n  }\n\n  async deriveFromPromiseOrValue(\n    input: PromiseOrValue<InputType>,\n    oldValuePromise: Promise<OutputType>,\n  ): Promise<OutputType> {\n    return this.derive(await input, oldValuePromise);\n  }\n\n  // TODO: add an indirect layer to cache the derivation?\n  protected abstract derive(\n    input: InputType,\n    oldValuePromise: Promise<OutputType>,\n  ): PromiseOrValue<OutputType>;\n}\n\nexport abstract class SimpleTwistyPropSource<\n  SimpleType,\n> extends TwistyPropSource<SimpleType> {\n  derive(input: SimpleType): PromiseOrValue<SimpleType> {\n    return input;\n  }\n}\n\n// TODO: Can we support `null` as a valid output value without loosening type\n// safety?\nexport const NO_VALUE = Symbol(\"no value\");\nexport type NoValueType = typeof NO_VALUE;\n\nexport abstract class TwistyPropDerived<\n  InputTypes extends InputRecord,\n  OutputType,\n> extends TwistyPropParent<OutputType> {\n  // cachedInputs:\n  #parents: InputProps<InputTypes>;\n\n  constructor(\n    parents: InputProps<InputTypes>,\n    protected userVisibleErrorTracker?: UserVisibleErrorTracker,\n  ) {\n    super();\n    this.#parents = parents;\n    for (const parent of Object.values(parents)) {\n      (\n        parent as TwistyPropDerived<InputProps<InputTypes>, OutputType>\n      ).addChild(this);\n    }\n  }\n\n  #cachedLastSuccessfulCalculation: {\n    inputs: InputTypes;\n    output: Promise<OutputType>;\n    generation: number;\n  } | null = null;\n\n  #cachedLatestGenerationCalculation: {\n    output: Promise<OutputType>;\n    generation: number;\n  } | null = null;\n\n  public async get(): Promise<OutputType> {\n    const generation = this.lastSourceGeneration;\n\n    if (this.#cachedLatestGenerationCalculation?.generation === generation) {\n      return this.#cachedLatestGenerationCalculation.output;\n    }\n\n    const latestGenerationCalculation = {\n      generation,\n      output: this.#cacheDerive(\n        this.#getParents(),\n        generation,\n        this.#cachedLastSuccessfulCalculation,\n      ),\n    };\n    this.#cachedLatestGenerationCalculation = latestGenerationCalculation;\n\n    this.userVisibleErrorTracker?.reset();\n    return latestGenerationCalculation.output;\n  }\n\n  async #getParents(): Promise<InputTypes> {\n    const inputValuePromises: InputPromises<InputRecord> = {} as any; // TODO\n    for (const [key, parent] of Object.entries(this.#parents)) {\n      (inputValuePromises as Record<string, Promise<unknown>>)[key] = (\n        parent as TwistyPropParent<unknown>\n      ).get();\n    }\n\n    const inputs: InputTypes = {} as any; // TODO\n    for (const key in this.#parents) {\n      inputs[key] = (await (\n        inputValuePromises as Record<string, Promise<unknown>>\n      )[key]) as any;\n    }\n    return inputs;\n  }\n\n  async #cacheDerive(\n    inputsPromise: PromiseOrValue<InputTypes>,\n    generation: number,\n    cachedLatestGenerationCalculation: {\n      inputs: InputTypes;\n      output: Promise<OutputType>;\n      generation: number;\n    } | null = null,\n  ): Promise<OutputType> {\n    const inputs = await inputsPromise;\n\n    const cache = (output: OutputType): OutputType => {\n      this.#cachedLastSuccessfulCalculation = {\n        inputs,\n        output: Promise.resolve(output),\n        generation,\n      };\n      return output;\n    };\n\n    if (!cachedLatestGenerationCalculation) {\n      return cache(await this.derive(inputs));\n    }\n\n    const cachedInputs = cachedLatestGenerationCalculation.inputs;\n    for (const key in this.#parents) {\n      const parent = this.#parents[key];\n      if (!parent.canReuse(inputs[key], cachedInputs[key])) {\n        return cache(await this.derive(inputs));\n      }\n    }\n\n    return cachedLatestGenerationCalculation.output;\n  }\n\n  protected abstract derive(input: InputTypes): PromiseOrValue<OutputType>;\n}\n\nexport class FreshListenerManager {\n  #disconnectionFunctions: (() => void)[] = [];\n\n  addListener<T>(\n    prop: TwistyPropParent<T>,\n    listener: (value: T) => void,\n  ): void {\n    let disconnected = false;\n    const wrappedListener = (value: T) => {\n      if (disconnected) {\n        // TODO\n        // console.warn(\"Should be disconnected!\");\n        return;\n      }\n      listener(value);\n    };\n\n    prop.addFreshListener(wrappedListener);\n\n    this.#disconnectionFunctions.push(() => {\n      prop.removeFreshListener(wrappedListener);\n      disconnected = true;\n    });\n  }\n\n  addMultiListener<U, V>(\n    props: [TwistyPropParent<U>, TwistyPropParent<V>],\n    listener: (values: [U, V]) => void,\n  ) {\n    let disconnected = false;\n\n    // We're going to get one initial call per prop. We'll ignore all but one.\n    let initialIgnoresLeft = props.length - 1;\n    const wrappedListener = async (_: any) => {\n      if (initialIgnoresLeft > 0) {\n        initialIgnoresLeft--;\n        return;\n      }\n      if (disconnected) {\n        // TODO\n        // console.warn(\"Should be disconnected!\");\n        return;\n      }\n      // We rely on `TwistyProp` caching to give us the full set of latest\n      // values efficiently.\n      const promises = (props as TwistyPropParent<any>[]).map((prop) =>\n        prop.get(),\n      );\n      const values = await Promise.all(promises);\n      listener(values as any); // TODO: fix up types\n    };\n\n    for (const prop of props) {\n      prop.addFreshListener(wrappedListener);\n    }\n\n    this.#disconnectionFunctions.push(() => {\n      for (const prop of props) {\n        prop.removeFreshListener(wrappedListener);\n      }\n      disconnected = true;\n    });\n  }\n\n  disconnect(): void {\n    for (const disconnectionFunction of this.#disconnectionFunctions) {\n      disconnectionFunction();\n    }\n  }\n}\n","import { SimpleTwistyPropSource } from \"../../TwistyProp\";\n\n// TODO: turn these maps into lists?\n// TODO: alg.cubing.net parity\nexport const experimentalStickerings = {\n  \"full\": true, // default\n  \"centers-only\": true, // TODO\n  \"PLL\": true,\n  \"CLS\": true,\n  \"OLL\": true,\n  \"COLL\": true,\n  \"OCLL\": true,\n  \"CLL\": true,\n  \"ELL\": true,\n  \"ELS\": true,\n  \"LL\": true,\n  \"F2L\": true,\n  \"ZBLL\": true,\n  \"ZBLS\": true,\n  \"WVLS\": true,\n  \"VLS\": true,\n  \"LS\": true,\n  \"EO\": true,\n  \"EOline\": true,\n  \"EOcross\": true,\n  \"CMLL\": true,\n  \"L6E\": true,\n  \"L6EO\": true,\n  \"Daisy\": true,\n  \"Cross\": true,\n  \"2x2x2\": true,\n  \"2x2x3\": true,\n  \"Void Cube\": true,\n  \"invisible\": true,\n  \"picture\": true,\n  \"experimental-centers-U\": true,\n  \"experimental-centers-U-D\": true,\n  \"experimental-centers-U-L-D\": true,\n  \"experimental-centers-U-L-B-D\": true,\n  \"experimental-centers\": true,\n  \"experimental-fto-fc\": true,\n  \"experimental-fto-f2t\": true,\n  \"experimental-fto-sc\": true,\n  \"experimental-fto-l2c\": true,\n  \"experimental-fto-lbt\": true,\n  \"experimental-fto-l3t\": true,\n  \"experimental-global-custom-1\": true,\n  \"experimental-global-custom-2\": true,\n};\nexport type ExperimentalStickering = keyof typeof experimentalStickerings;\n\nexport class StickeringProp extends SimpleTwistyPropSource<ExperimentalStickering> {\n  getDefaultValue(): ExperimentalStickering {\n    return \"full\"; // TODO: auto\n  }\n}\n","import { SimpleTwistyPropSource } from \"../../TwistyProp\";\n\n// TODO: turn these maps into lists?\nexport const hintFaceletStyles = {\n  floating: true, // default\n  none: true,\n};\nexport type HintFaceletStyle = keyof typeof hintFaceletStyles;\nexport type HintFaceletStyleWithAuto = HintFaceletStyle | \"auto\";\n\nexport class HintFaceletProp extends SimpleTwistyPropSource<HintFaceletStyleWithAuto> {\n  getDefaultValue(): HintFaceletStyleWithAuto {\n    return \"auto\";\n  }\n}\n","export const TAU = Math.PI * 2;\nexport const DEGREES_PER_RADIAN = 360 / TAU;\n","import { from } from \"../../vendor/p-lazy/p-lazy\";\n\n// TODO can we remove the cached proxy?\n\n// In theory we can, but we've run into situations where imports are not properly cached.\nlet cachedConstructorProxy: Promise<\n  typeof import(\"./dynamic-entries/3d-dynamic\")\n> | null = null;\n\nexport async function proxy3D(): Promise<\n  typeof import(\"./dynamic-entries/3d-dynamic\")\n> {\n  return (cachedConstructorProxy ??= import(\"./dynamic-entries/3d-dynamic\"));\n}\n\nexport const THREEJS: Promise<typeof import(\"three\")> = from(\n  async () => (await proxy3D()).T3I,\n);\n","module.exports = Promise.all([__parcel__import__(\"./\" + require('./helpers/bundle-manifest').resolve(\"adU6T\")), __parcel__import__(\"./\" + require('./helpers/bundle-manifest').resolve(\"8hzZ2\")), __parcel__import__(\"./\" + require('./helpers/bundle-manifest').resolve(\"fUYHb\"))]).then(() => parcelRequire('f36qW'));"],"names":["parcelRequire","register","JSON","parse","$4f1c387ac483c013$var$PLazy","Promise","executor","super","resolve","this","_executor","function_","value","error","_resolve","reject","then","onFulfilled","onRejected","_promise","catch","$4f1c387ac483c013$var$from","$4f1c387ac483c013$var$_latestAssignedIdx2","$4f1c387ac483c013$var$_latestResolvedIdx2","WeakMap","$4f1c387ac483c013$export$4c5bf6e094d8f142","$cks0r","__privateAdd","queue","p","async","idx","__privateWrapper","_","result","__privateGet","__privateSet","e","$4f1c387ac483c013$var$_children","$4f1c387ac483c013$var$_rawListeners","$4f1c387ac483c013$var$_scheduleRawDispatch","$4f1c387ac483c013$var$scheduleRawDispatch_fn","$4f1c387ac483c013$var$_rawDispatchPending","$4f1c387ac483c013$var$_dispatchRawListeners","$4f1c387ac483c013$var$dispatchRawListeners_fn","$4f1c387ac483c013$var$_freshListeners","$4f1c387ac483c013$var$_value","$4f1c387ac483c013$var$globalSourceGeneration","$4f1c387ac483c013$var$TwistyPropParent","Set","lastSourceGeneration","Map","canReuse","v1","v2","canReuseValue","_v1","_v2","debugGetChildren","Array","from","values","addChild","child","add","removeChild","delete","markStale","sourceEvent","detail","generation","Error","__privateMethod","call","addRawListener","listener","options","initial","removeRawListener","addFreshListener","staleDropper","lastResult","callback","get","set","removeFreshListener","WeakSet","setTimeout","$4f1c387ac483c013$export$99f7895067f54bbe","initialValue","getDefaultValue","deriveFromPromiseOrValue","input","sourceEventDetail","sourceProp","CustomEvent","oldValuePromise","derive","$4f1c387ac483c013$var$_parents","$4f1c387ac483c013$var$_cachedLastSuccessfulCalculation","$4f1c387ac483c013$var$_cachedLatestGenerationCalculation","$4f1c387ac483c013$var$_getParents","$4f1c387ac483c013$var$getParents_fn","$4f1c387ac483c013$var$_cacheDerive","$4f1c387ac483c013$var$cacheDerive_fn","$4f1c387ac483c013$var$_disconnectionFunctions","$4f1c387ac483c013$export$9cc0345f25c4e739","$4f1c387ac483c013$export$d5a265bcf7e0ecc1","Symbol","$4f1c387ac483c013$export$bd74bdc934d3c98e","parents","userVisibleErrorTracker","parent","Object","output","latestGenerationCalculation","reset","inputValuePromises","key","entries","inputs","key1","inputsPromise","cachedLatestGenerationCalculation","cache","cachedInputs","$4f1c387ac483c013$export$70b517844adbfd19","addListener","prop","disconnected","wrappedListener","push","addMultiListener","props","initialIgnoresLeft","length","promises","map","all","prop1","disconnect","disconnectionFunction","$4f1c387ac483c013$export$149a3858f06e107e","full","PLL","CLS","OLL","COLL","OCLL","CLL","ELL","ELS","LL","F2L","ZBLL","ZBLS","WVLS","VLS","LS","EO","EOline","EOcross","CMLL","L6E","L6EO","Daisy","Cross","invisible","picture","$4f1c387ac483c013$export$6489fb243f2aa5c5","$4f1c387ac483c013$export$44c8b061898f8d28","floating","none","$4f1c387ac483c013$export$f7f72cc4c346e939","$4f1c387ac483c013$export$ad5b0b9ab7d48f58","Math","PI","$4f1c387ac483c013$export$3627dc5537d31f6e","$4f1c387ac483c013$var$cachedConstructorProxy","$4f1c387ac483c013$export$c3adadba212f68ff","$4f1c387ac483c013$export$a683b6645feb2503","T3I","module","exports"],"version":3,"file":"index.8fe6b841.js.map"}